news_collecting:
  description: >
    Thu thập và phân tích thông tin vĩ mô, tin tức thị trường và xu hướng kinh tế ảnh hưởng đến 
    thị trường chứng khoán Việt Nam trong ngày {current_date}.

    QUAN TRỌNG: Task này sử dụng hệ thống cache thông minh để tránh lặp lại phân tích.
    
    Quy trình thực hiện:
    1. Sử dụng công cụ `macro_analysis_tool` để thực hiện phân tích vĩ mô và tin tức thị trường.
    2. Công cụ sẽ tự động kiểm tra cache - nếu đã có phân tích trong ngày sẽ sử dụng lại.
    3. Chỉ thực hiện phân tích mới khi chưa có dữ liệu cache hoặc cache đã hết hạn (24 giờ).
    4. Kết quả bao gồm: tin tức thị trường, xu hướng kinh tế, chính sách tài chính và tâm lý thị trường.

    Ưu điểm của hệ thống cache:
    - Tiết kiệm token API và thời gian xử lý
    - Đảm bảo tính nhất quán trong phân tích vĩ mô cho tất cả cổ phiếu trong cùng ngày
    - Tự động cập nhật mỗi 24 giờ với thông tin mới nhất
    
    Lưu ý: Không cần sử dụng SerperDevTool hay ScrapeWebsiteTool trực tiếp - đã được tích hợp trong macro_analysis_tool.
  expected_output: >
    Báo cáo phân tích vĩ mô và thị trường bằng tiếng Việt, bao gồm:
    - Tóm tắt tin tức và sự kiện quan trọng ảnh hưởng đến thị trường
    - Phân tích xu hướng kinh tế và chính sách tài chính
    - Đánh giá tâm lý thị trường và dòng tiền
    - Tác động dự kiến đến các nhóm ngành và cổ phiếu
    
    Kết quả được tối ưu hóa với cache để sử dụng chung cho tất cả phân tích cổ phiếu trong ngày.

  agent: stock_news_researcher

fundamental_analysis:
  description: >
    Phân tích cơ bản mã cổ phiếu {symbol} dựa trên các chỉ số tài chính để đánh giá mức định giá và sức khỏe doanh nghiệp.

    Quy trình thực hiện:
    1. Sử dụng công cụ `accurate_fund_tool` để thu thập các chỉ số chính xác: P/E, P/B, ROE, D/E, EPS, EV/EBITDA, tăng trưởng doanh thu/lợi nhuận, và biên lợi nhuận.
       Công cụ này sử dụng P/E Calculator để tránh thiên kiến dữ liệu và tính P/E chính xác từ báo cáo tài chính.
    2. Xác định cổ phiếu thuộc ngành nào.
    3. So sánh P/E và P/B của cổ phiếu với trung bình ngành từ tệp `knowledge/PE_PB_industry_average.json`.
       Nếu ngành chưa có dữ liệu, sử dụng ngành gần nhất tương đương.
    4. Phân tích các chỉ số còn lại để đánh giá hiệu suất hoạt động và mức độ rủi ro tài chính.
    5. Đánh giá chất lượng dữ liệu và các thiên kiến có thể ảnh hưởng đến kết quả phân tích.

    Ngày thực hiện: {current_date}
  expected_output: >
    Một báo cáo bằng tiếng Việt, dài 2–3 đoạn, bao gồm:
    - Nhận định định giá: rẻ / đắt / hợp lý (dựa trên P/E chính xác)
    - Đánh giá hiệu quả hoạt động tài chính: liệu các chỉ số nằm trong ngưỡng tốt hay không
    - Phân tích thiên kiến dữ liệu: đánh giá độ tin cậy của các chỉ số
    - Nhận xét tổng thể về triển vọng kinh doanh

  agent: fundamental_analyst

technical_analysis:
  description: >
    Đánh giá xu hướng giá của cổ phiếu {symbol} trong ngày {current_date} thông qua phân tích kỹ thuật.

    Quy trình thực hiện:
    1. Sử dụng công cụ `tech_tool` để thu thập các chỉ báo: SMA, EMA, RSI, MACD, khối lượng giao dịch, OBV và xác định vùng hỗ trợ/kháng cự.
    2. Xác định xu hướng hiện tại (tăng/giảm/tích lũy).
    3. Đưa ra đánh giá động lượng và khả năng xuất hiện tín hiệu giao dịch.

  expected_output: >
    Một báo cáo bằng tiếng Việt, dài 2–3 đoạn, bao gồm:
    - Nhận định xu hướng hiện tại (tăng/giảm/đi ngang)
    - Phân tích tín hiệu kỹ thuật (ví dụ: RSI quá mua/quá bán, giao cắt MACD...)
    - Đánh giá tổng thể về thời điểm mua bán từ góc nhìn kỹ thuật

  agent: technical_analyst

investment_decision:
  description: >
    Dựa trên kết quả tổng hợp từ các phân tích thành phần (news_collecting, fundamental_analysis, technical_analysis), 
    đánh giá mã cổ phiếu {symbol} bằng hệ thống điểm số lượng hóa và đưa ra khuyến nghị đầu tư cụ thể.

    **BẮT BUỘC**: Sử dụng công cụ `Investment Decision Tool` với các tham số:
    - symbol: {symbol}
    - fundamental_analysis: Nội dung từ task fundamental_analysis
    - technical_analysis: Nội dung từ task technical_analysis  
    - macro_analysis: Nội dung từ task news_collecting

    Công cụ sẽ tự động:
    1. Chấm điểm từng yếu tố (thang điểm 0–10) với logic thông minh
    2. Tính điểm tổng hợp với trọng số cân bằng (40%-40%-20%)
    3. Áp dụng logic override để đảm bảo an toàn đầu tư
    4. Tạo khuyến nghị nhất quán: MUA/GIỮ/BÁN với giải thích chi tiết
    5. Đưa ra giá mục tiêu dựa trên phân tích kỹ thuật

    Lưu ý:
    - **BẮT BUỘC** phải sử dụng tool, không được tự tạo kết quả
    - Tool đã tích hợp logic override thông minh để đảm bảo tính nhất quán
    - Kết quả sẽ có định dạng JSON chuẩn cho hệ thống

  expected_output: >
    Một đoạn văn bằng tiếng Việt, có cấu trúc chuẩn như sau:
    - Tên công ty, mã cổ phiếu, ngành nghề
    - **Phân tích vĩ mô**: Tóm tắt khoảng 200 từ + điểm (0–10) + lý do
    - **Phân tích cơ bản**: Tóm tắt khoảng 200 từ + điểm (0–10) + lý do
    - **Phân tích kỹ thuật**: Tóm tắt khoảng 200 từ + điểm (0–10) + lý do
    - **Kết luận**: tính điểm trung bình (ví dụ: 7.8/10) và đưa ra khuyến nghị MUA / GIỮ / BÁN
    - **Nếu GIỮ**: đề xuất 2 mức giá mục tiêu để MUA và BÁN dựa trên phân tích kỹ thuật.

  agent: investment_strategist